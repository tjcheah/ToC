
<!DOCTYPE html>
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">

<!-- jQuery library -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<!-- Latest compiled JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
<style>
    table.table1 {
        border-collapse: collapse;
    }

    th, td {
        min-width: 30px;
        padding: 10px;
    }

    div.centerwrapper {
        margin-left: auto;
        margin-right: auto;
        max-width: 800px;
    }

    div.gallery {
        margin: 5px;
        border: 1px solid #ccc;
        float: left;
        width: 180px;
        display: inline-block;
    }

        div.gallery:hover {
            border: 1px solid #777;
        }

        div.gallery img {
            width: 100%;
            height: auto;
        }

    div.block {
        margin: 5px 5px 5px 5px;
        border: 1px solid #ccc;
        float: left;
        width: 192px;
        display: inline-block;
    }

    div.desc {
        padding: 15px;
        text-align: center;
    }

    div.RGinput {
        float: left;
        position: static;
    }

    #dynamic_table {
        position: static;
        margin-top: 6px;
        margin-left: 5px;
        display: inline-block;
    }

    div.Checkstrings {
        position: static;
        margin-left: 800px;
        margin-top: 10px;
    }
</style>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title></title>
</head>
<body>

    <div class="container">
        <h2>Assignment</h2>
        <p>TIC2151 - Theory of Computation</p>

        <ul class="nav nav-tabs">
            <li class="active"><a data-toggle="tab" href="#home">Home</a></li>
            <li><a data-toggle="tab" href="#RgtoNfa">RG -> NFA</a></li>
            <li><a data-toggle="tab" href="#NfatoRg">NFA -> RG</a></li>
            <li><a data-toggle="tab" href="#helpDoc">Help + Doc</a></li>
        </ul>

        <div class="tab-content">
            <div id="home" class="tab-pane fade in active" style="text-align:center;">
                <h3 style="text-align:center;">Theory of Computation</h3>
                <div class="centerwrapper">
                    <div class="block">
                        <div class="gallery">
                            <a target="_blank" href="img_forest.jpg">
                                <img src="img_forest.jpg" width="600" height="400">
                            </a>
                            <div class="desc">Leader</div>
                        </div>
                    </div>
                    <div class="gallery">
                        <a target="_blank" href="tati.jpg">
                            <img src="tati.jpg" width="600" height="400">
                        </a>
                        <div class="desc">Tatiana Joanne Cheah (1161104048)</div>
                    </div>

                    <div class="gallery">
                        <a target="_blank" href="img_lights.jpg">
                            <img src="img_lights.jpg" alt="Northern Lights" width="600" height="400">
                        </a>
                        <div class="desc">Add member details here</div>
                    </div>

                    <div class="gallery">
                        <a target="_blank" href="img_mountains.jpg">
                            <img src="img_mountains.jpg" alt="Mountains" width="600" height="400">
                        </a>
                        <div class="desc">Add member details here</div>
                    </div>
                </div>
            </div>
            <div id="RgtoNfa" class="tab-pane fade">
                <!-- Input for RG -->
                <div class="RGinput">
                    <h5>Regular Grammar (input - here is &epsilon; symbol to paste when needed)</h5>
                    <table class="table1 table-bordered">
                        <thead>
                            <tr>
                                <th scope="col">State</th>
                                <th scope="col">Transition</th>
                                <th colspan="9" style="text-align:center;">Variables</th>
                            </tr>
                            <tr>
                                <td><input type="text" id="s1" maxlength="1" size="1"></td>
                                <td><p style="text-align:center;">&rarr;</p></td>
                                <td><input type="text" id="v11" maxlength="5" size="5"></td>
                                <td><p style="text-align:center;">&#x7c;</p></td>
                                <td><input type="text" id="v12" maxlength="5" size="5"></td>
                                <td><p style="text-align:center;">&#x7c;</p></td>
                                <td><input type="text" id="v13" maxlength="5" size="5"></td>
                                <td><p style="text-align:center;">&#x7c;</p></td>
                                <td><input type="text" id="v14" maxlength="5" size="5"></td>
                                <td><p style="text-align:center;">&#x7c;</p></td>
                                <td><input type="text" id="v15" maxlength="5" size="5"></td>
                            </tr>
                            <tr>
                                <td><input type="text" id="s2" maxlength="1" size="1"></td>
                                <td><p style="text-align:center;">&rarr;</p></td>
                                <td><input type="text" id="v21" maxlength="5" size="5"></td>
                                <td><p style="text-align:center;">&#x7c;</p></td>
                                <td><input type="text" id="v22" maxlength="5" size="5"></td>
                                <td><p style="text-align:center;">&#x7c;</p></td>
                                <td><input type="text" id="v23" maxlength="5" size="5"></td>
                                <td><p style="text-align:center;">&#x7c;</p></td>
                                <td><input type="text" id="v24" maxlength="5" size="5"></td>
                                <td><p style="text-align:center;">&#x7c;</p></td>
                                <td><input type="text" id="v25" maxlength="5" size="5"></td>
                            </tr>
                            <tr>
                                <td><input type="text" id="s3" maxlength="1" size="1"></td>
                                <td><p style="text-align:center;">&rarr;</p></td>
                                <td><input type="text" id="v31" maxlength="5" size="5"></td>
                                <td><p style="text-align:center;">&#x7c;</p></td>
                                <td><input type="text" id="v32" maxlength="5" size="5"></td>
                                <td><p style="text-align:center;">&#x7c;</p></td>
                                <td><input type="text" id="v33" maxlength="5" size="5"></td>
                                <td><p style="text-align:center;">&#x7c;</p></td>
                                <td><input type="text" id="v34" maxlength="5" size="5"></td>
                                <td><p style="text-align:center;">&#x7c;</p></td>
                                <td><input type="text" id="v35" maxlength="5" size="5"></td>
                            </tr>
                            <tr>
                                <td><input type="text" id="s4" maxlength="1" size="1"></td>
                                <td><p style="text-align:center;">&rarr;</p></td>
                                <td><input type="text" id="v41" maxlength="5" size="5"></td>
                                <td><p style="text-align:center;">&#x7c;</p></td>
                                <td><input type="text" id="v42" maxlength="5" size="5"></td>
                                <td><p style="text-align:center;">&#x7c;</p></td>
                                <td><input type="text" id="v43" maxlength="5" size="5"></td>
                                <td><p style="text-align:center;">&#x7c;</p></td>
                                <td><input type="text" id="v44" maxlength="5" size="5"></td>
                                <td><p style="text-align:center;">&#x7c;</p></td>
                                <td><input type="text" id="v45" maxlength="5" size="5"></td>
                            </tr>
                        </thead>
                    </table>
                    <button id="RG_submit" style="margin-top:5px;">Convert RG into NFA</button>
                </div>
                <div class="Checkstrings">
                    <table>
                        <tr>
                            <td>
                                <div>
                                    <h5>Check String (input)</h5>
                                    <textarea id="textinput" cols="20" rows="5" style="resize:none;"></textarea>
                                    <br>
                                    <button id="Checkstring1">Check</button>
                                </div>
                            </td>
                            <td>
                                <table>
                                    <tr>
                                        <td style="padding: 0;" id="z1"></td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 0;" id="z2"></td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 0;" id="z3"></td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 0;" id="z4"></td>
                                    </tr>
                                    <tr>
                                        <td style="padding: 0;" id="z5"></td>
                                    </tr>
                                </table>
                            </td>
                        </tr>
                    </table>
                </div>
                <br>
                <br>
                <br>
                <br>
                <table id="dynamic_table">
                    <tr>
                        <td>
                            <div id="formal_def"></div>
                        </td>
                        <td>
                            <div id="trans_table"></div>
                        </td>
                        <td>
                            <div id="trans_table2"></div>
                        </td>
                    </tr>
                </table>
                <script>
                    $(document).ready(function () {
                        $('#RG_submit').click(function () {
                            document.getElementById("formal_def").innerHTML = "";
                            var check_states = function (a, start, end) {
                                if (a != start) {
                                    return a;
                                }
                                else if (a === start) {
                                    a = "> " + a;
                                    return a;
                                }
                                else if (a === end) {
                                    a = "* " + a;
                                    return a;
                                }
                            }

                            var check_final = function (a, prev) {
                                if (a != "") {
                                    return a
                                }
                                else {
                                    return prev
                                }
                            }
                            //determine states
                            start = $('#s1').val();
                            end = check_final($('#s2').val(), start);
                            end = check_final($('#s3').val(), end);
                            end = check_final($('#s4').val(), end);


                            //for presenting states in transition table
                            var st1 = check_states($('#s1').val(), start, end);
                            var st2 = check_states($('#s2').val(), start, end);
                            var st3 = check_states($('#s3').val(), start, end);
                            var st4 = check_states($('#s4').val(), start, end);

                            console.log($('#s1').val());

                            states = [];
                            states.push(start, st2, st3, st4);
                            list_states = [];
                            list_states1 = [];
                            list_states_contain = []; // contain how many ways does it contains.
                            let i = 0;
                            while (i < 4) {
                                if (states[i] != "") {
                                    list_states.push(states[i]);
                                    list_states1.push(states[i]);
                                }
                                i++;
                            }

                            //determine alphabets
                            let list1 = [];
                            let list2 = [];
                            let list3 = [];
                            alphas = [];
                            pushStack = [];
                            combined = [[], []];
                            var vtext = "#v";
                            var eps = 'ε';
                            var empt = '∅';
                            i = 1;
                            let j = 1;
                            var contains;

                            while (i < 5) {
                                combined[i - 1] = new Array();
                                combined[i - 1].push(pushStack);
                                contains = 0;
                                while (j < 6) {
                                    list1.push($(vtext + i + j).val());
                                    if ($(vtext + i + j).val().length != 0 && $(vtext + i + j).val() != 'ε') {
                                        var stringTemp = $(vtext + i + j).val();
                                        var stringTempi = stringTemp.match(/[A-Z]/g);
                                        stringTempi = stringTempi.filter(item => item);
                                        var stringTempj = stringTemp.match(/[a-z]*/g);
                                        stringTempj = stringTempj.filter(item => item);
                                        if (stringTempj.length != 0) {
                                            combined[i - 1][j - 1] = { i: stringTempi, j: stringTempj, index: j, alphas: stringTempj };
                                        } else {
                                            combined[i - 1][j - 1] = { i: stringTempi, j: stringTempj, index: j, alphas: "ε" };
                                        }
                                        contains += 1;
                                    } else {
                                        combined[i - 1][j - 1] = { i: empt, j: empt, index: j, alphas: null };
                                    }
                                    j++;
                                }
                                list_states_contain[i - 1] = { state: list_states[i - 1], contains: contains };
                                i++;
                                j = 1;
                            }

                            let x = 0;
                            let y = 0;
                            let w = 0;
                            let found = 0;

                            //looks out for lowercase letters
                            while (x < 20) {
                                if (list1[x] != "") {
                                    list3 = list1[x].split('');
                                    while (y < list3.length && (/[a-z]/.test(list3[y]) || /[0-9]/.test(list3[y]))) {
                                        while (w <= list2.length) {
                                            if (list2[w] == list3[y]) {
                                                found = 1;
                                            }
                                            w++;
                                        }
                                        
                                        if (found == 0) {
                                            list2.push(list3[y]);
                                        }
                                        y++;
                                        w = 0;
                                        found = 0;
                                    }
                                    if (list3[y] == eps) {//add star to a state with epsilon to mark it as accept state
                                        if (x < 5) {
                                            st1 = "*" + st1;
                                            list_states.splice(0, 1, st1);
                                        }
                                        else if (x > 4 && x < 10) {
                                            st2 = "*" + st2;
                                            list_states.splice(1, 1, st2);
                                        }
                                        else if (x > 9 && x < 15) {
                                            st3 = "*" + st3;
                                            list_states.splice(2, 1, st3);
                                        }
                                    }
                                }
                                x++;
                                y = 0;
                            }
                            x = 0;
                            while (x < list2.length) {
                                alphas.push(list2[x]);
                                x++;
                            }

                            for (let p = 0; p < combined.length; p++) {
                                console.log(p + " : " + combined[p].length);
                            }

                            $('#formal_def').append('<p><b>M = (Q, &Sigma;, &delta;, p<sub>0</sub>, F)</b><br>Q ={' + list_states1.join(", ") + '}<br>&Sigma; = {' + alphas.join(", ") + '}<br>&delta;: Q &times; &sum;<sub>&epsilon;</sub> &rarr; Pow(Q)<br>p<sub>0</sub> = ' + start + '<br>F = {' + end + '}<p>');
                            //creating dynamic table for NFA
                            document.getElementById("trans_table").innerHTML = "<table class='table1 table-bordered' id='trans_bordered'></table>";

                            alphas.push("ε");

                            // swap place follow the location of the alphas
                            var index;
                            for (let p = 0; p < combined.length; p++) {
                                for (let q = 0; q < combined[p].length; q++) {
                                    if (combined[p][q].alphas != alphas[q] && combined[p][q].j != '&Theta;') {
                                        var temp = combined[p][q];
                                        index = combined[p][q].index;
                                        for (let r = q; r < alphas.length; r++) {
                                            if (combined[p][q].alphas == alphas[r]) {
                                                var temp1 = combined[p][r];
                                                combined[p][r] = temp;
                                                combined[p][q] = temp1;
                                                console.log(combined[p][q].j + " : " + combined[p][r].j);
                                                break;
                                            }
                                        }
                                    }
                                }
                            }

                            // display the table
                            var body = document.body,
                                tbl = document.getElementById('trans_bordered');

                            for (var m = 0; m < list_states.length + 1; m++) {
                                var tr = tbl.insertRow();
                                for (var n = 0; n < alphas.length + 1; n++) {
                                    var td = tr.insertCell();
                                    if (n >= 1 && m == 0) {
                                        // put all the variable to the most top of the table
                                        td.appendChild(document.createTextNode(alphas[n - 1]));
                                    } else if (m != 0 && n == 0) {
                                        // put all the state name to the most left of the table
                                        var compare = list_states[m - 1];
                                        if (compare == start) {
                                            // if the state is the initial state
                                            compare = ">" + compare;
                                        }
                                        if (compare == end) {
                                            // if the state is the final state
                                            compare = "*" + compare;
                                        }
                                        td.appendChild(document.createTextNode(compare));
                                    } else if (n == 0 && m == 0) {
                                        td.appendChild(document.createTextNode(" "));
                                    } else {
                                        if (combined[m - 1][n - 1] != null) {
                                            td.appendChild(document.createTextNode(combined[m - 1][n - 1].i));
                                        }
                                    }
                                }
                            }
                        });
                        $('#Checkstring1').click(function () {
                            var stringRegex = "/^";

                            var indexStart;

                            for (let i = 0; i < list_states1.length; i++) {
                                if (start == list_states1[i]) {
                                    indexStart = i;
                                }
                            }

                            var l = list_states_contain;
                            var c = combined;
                            var a = alphas;

                            stringRegex += recurse(l, c, a, -1, start);

                            stringRegex += "$/gm";

                            console.log("stringRegex : " + stringRegex);

                            // console.log("Start : " + indexStart + " : " + combined[indexStart][0].i + " : " + combined[indexStart][0].j);

                            var textInput = $('#textinput').val();
                            var textArr = textInput.split('\n');
                            var rg = regexFunction(stringRegex);


                            for (let i = 0; i < textArr.length; i++) {
                                if (textArr[i].match(rg) != null) {
                                    textArr[i] += " -> Ok!";
                                } else {
                                    textArr[i] += " -> No!";
                                }
                                console.log(textArr[i] + " : " + typeof (textArr[i]));
                            }
                            console.log(textArr.join('\n'));
                            $("#textinput").val(textArr.join('\n'));

                        });
                    });

                    function recurse(l, c, a, i, n) {
                        if (l === undefined) {
                            return;
                        } else {
                            console.log("n is : " + n);
                            i += 1;
                            var found = false;
                            var z = 0;
                            l.forEach(e => {
                                if (e.state == n) {
                                    console.log(e.state + " : " + n);
                                    console.log(typeof (e.state) + " " + typeof (n));
                                }
                            });
                            var search = l.map(function (e) { return e.state; }).indexOf(n);
                            c.forEach(e => {
                                console.log(e.i + " : " + e.j);
                            });
                            console.log("search : " + search);
                            // var search = l.findIndex(x => x.state === n)
                            if (search != -1) {
                                console.log("more then search");
                                var s = c[search];
                                c.splice(search, 1);
                                var lT = l[search];
                                l.splice(search, 1);
                                console.log(lT.state + " : " + lT.contains);
                                if (lT.contains < 2) {
                                    console.log(n + " sama tak dgn " + s[0].i);
                                    var stringT = "";
                                    s.forEach(e => {
                                        console.log(e.i + " : " + n);
                                        console.log(typeof (e.state) + " " + typeof (n));
                                        if (e.i != '&Theta;' && e.j != null && e.j != undefined) {
                                            stringT += e.j;
                                            n = String(e.i);
                                        }
                                    });
                                    if (stringT !== null && stringT !== '') {
                                        console.log("StringT : " + stringT);
                                        return stringT + recurse(l, c, a, i, n);
                                    } else {
                                        return "";
                                    }
                                } else {
                                    var searchT = s.map(function (e) { return String(e.i); }).indexOf(String(n));
                                    var stringT = "";
                                    if (searchT != -1) {
                                        stringT += s[searchT].j + "*";
                                        s.splice(searchT, 1);
                                        for (let p = 0; p < s.length; p++) {
                                            if (s[p].i != '&Theta;') {
                                                stringT += s[p].j;
                                                n = String(s[p].i);
                                            }
                                        }
                                    } else {
                                        s.forEach(e => {
                                            if (e.i != '&Theta;') {
                                                stringT += e.j;
                                                n = String(e.i);
                                            }
                                        });
                                    }
                                    console.log(stringT);
                                    return stringT + recurse(l, c, a, i, n);
                                }
                            }
                        }
                    }

                    function regexFunction(string) {
                        var a = string.split("/");
                        modifiers = a.pop(); a.shift();
                        pattern = a.join("/");
                        return new RegExp(pattern, modifiers);
                    }
                </script>
            </div>
            <div id="NfatoRg" class="tab-pane fade">
                <h3>Menu 2</h3>
                <p>Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam.</p>
            </div>
            <div id="helpDoc" class="tab-pane fade">
                <h5>Some restrictions applied:</h5>
                <b><u>For RG to NGA</u></b>
                <ul>
                    <li>No row has a repeated variables (e.g. <u>a</u>A| <u>a</u>B <b>or</b> <u>aa</u>B)</li>
                    <li>Variable cannot be formatted as 'a' (single lowercase)</li>
                    <li>Variables can only be in 'aB' (lowercase and uppercase) format or 'A' (single uppercase)</li>
                </ul>
            </div>
        </div>
    </div>

</body>
</html>
